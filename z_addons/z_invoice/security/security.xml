<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        <!-- Email Wizard Security Group -->
        <record id="group_invoice_email_wizard" model="res.groups">
            <field name="name">Invoice Email Wizard</field>
            <field name="category_id" ref="base.module_category_hidden"/>
            <field name="comment">Users can send invoice emails through the wizard</field>
        </record>

        <!-- Inherit Account Invoice group to include email wizard permissions -->
        <record id="account.group_account_invoice" model="res.groups">
            <field name="implied_ids" eval="[(4, ref('group_invoice_email_wizard'))]"/>
        </record>

        <!-- Record rule for email wizard - only users with invoice access can use it -->
        <record id="rule_email_wizard_invoice_access" model="ir.rule">
            <field name="name">Email Wizard: Invoice Access</field>
            <field name="model_id" ref="model_account_move_email_wizard"/>
            <field name="domain_force">[('move_id.company_id', 'in', company_ids)]</field>
            <field name="groups" eval="[(4, ref('account.group_account_invoice'))]"/>
        </record>

        <!-- Record rule for email wizard - users can only access wizards for invoices they can access -->
        <record id="rule_email_wizard_move_access" model="ir.rule">
            <field name="name">Email Wizard: Move Access</field>
            <field name="model_id" ref="model_account_move_email_wizard"/>
            <field name="domain_force">[('move_id', 'in', user.invoice_ids.ids)]</field>
            <field name="groups" eval="[(4, ref('account.group_account_user'))]"/>
        </record>
    </data>
</odoo> 